# פרויקט KeyLogger

## סקירה כללית
פרויקט KeyLogger הוא מערכת מעקב מקלדת מבוססת לקוח-שרת המאפשרת ניטור ורישום של הקשות מקלדת במחשבי קצה. המערכת מורכבת משני חלקים עיקריים:

1. **KeyLoggerAgent** - יישום לקוח שרץ על מחשבי היעד ואוסף נתוני הקלדה
2. **KeyLoggerServer** - שרת מרכזי המקבל, מאחסן ומציג את הנתונים שנאספו

## מטרה
פרויקט זה מיועד לשימושים לגיטימיים בלבד כגון:
- למידה ומחקר
- ניטור מערכות IT בארגונים
- בקרת שימוש במחשבים ציבוריים
- אבטחת מערכות מידע

## מאפיינים עיקריים
- תיעוד הקשות מקלדת בזמן אמת
- הצפנת נתונים לשמירה על בטיחות המידע
- ממשק ווב מתקדם לניהול וצפייה בנתונים
- אימות משתמשים עם JWT
- ניתוח נתונים לפי מכונות, חלונות פעילים וזמנים
- יכולת כיבוי מרחוק של סוכני הניטור
- צילום מסך מרחוק בזמן אמת
- תצוגת נתונים גרפית
- מיון נתונים לפי קטגוריות שונות

## דרישות מערכת
- Python 3.6 ומעלה
- התקנת ספריות המפורטות ב-`requirements.txt` הכוללות:
  - flask, flask-cors, flask-jwt-extended
  - pynput, pygetwindow
  - pyyaml, python-dotenv
  - requests
  - pyautogui, Pillow

## התקנה

### התקנת שרת
1. התקן את הספריות הנדרשות:
```bash
pip install -r requirements.txt
```

2. נווט לתיקיית KeyLoggerServer:
```bash
cd KeyLoggerServer
```

3. בצע התאמות בקובץ .env (מפתח סודי):
```
SECRET_KEY=YourSecretKey
```

4. צור קובץ `users.json` עם פרטי המשתמשים:
```json
{
  "user1": "password1",
  "a": "p"
}
```

5. הפעל את השרת:
```bash
python app.py
```
השרת יפעל בכתובת http://127.0.0.1:9734 (כברירת מחדל)

### התקנת סוכן (במחשבי היעד)
1. התקן את הספריות הנדרשות:
```bash
pip install -r requirements.txt
```

2. נווט לתיקיית KeyLoggerAgent:
```bash
cd KeyLoggerAgent
```

3. עדכן את קובץ התצורה `config.yaml` עם כתובת השרת הנכונה:
```yaml
general:
  base_url: http://[כתובת_השרת]:9734/
```

4. הפעל את הסוכן:
```bash
python main.py
```

## ארכיטקטורה

### KeyLoggerAgent
הסוכן מורכב מהרכיבים הבאים:
- **main.py** - נקודת הכניסה הראשית, יוצרת חיבור לשרת ורושמת את המכונה
- **manager.py** - מנהל את תהליך ההקלטה, השליחה של נתונים לשרת וצילום מסך מרחוק
- **service.py** - מספק שירותים להקלטת מקשים, שליחה לשרת והצפנה
- **Interface.py** - מגדיר ממשקים לפונקציונליות הדרושה
- **utils.py** - כלי עזר שונים, כולל זיהוי שפה במקלדת ופורמט מקשים

### KeyLoggerServer
השרת מורכב מהרכיבים הבאים:
- **app.py** - יישום Flask המספק את ה-API וממשק המשתמש
- **utils.py** - פונקציות עזר לפיענוח, מיזוג נתונים וקיבוץ מידע
- **templates/** - תבניות HTML לממשק המשתמש
- **static/** - קבצי CSS, JavaScript ונכסים סטטיים אחרים
- **logs/** - תיקייה לאחסון הנתונים שנאספו

## API ואבטחה
המערכת משתמשת בטוקני JWT לאימות. נתונים מועברים באופן מאובטח באמצעות הצפנה סימטרית, כאשר מפתח ייחודי נוצר עבור כל מכונה מנוטרת. הנתונים מוצפנים בצד הלקוח ומפוענחים בצד השרת.

## תרשים זרימת עבודה
1. Agent מתחיל ורושם את עצמו בשרת
2. השרת מייצר מספר סידורי ומפתח הצפנה ייחודי עבור הסוכן
3. הסוכן מקליט הקשות מקלדת ושומר אותן לפי חלון פעיל וזמן
4. הנתונים מוצפנים ונשלחים לשרת כל 10 שניות
5. הסוכן מבצע בדיקה לפקודות מהשרת (כיבוי, צילום מסך)
6. השרת מפענח ומאחסן את הנתונים
7. ניתן לצפות בנתונים דרך ממשק הניהול הגרפי

## תכונות ממשק משתמש
- לוח מחוונים מרכזי המציג את כל המחשבים המנוטרים
- סינון ומיון נתונים לפי תאריכים, זמנים, חלונות
- גרף פעילות המציג את כמות הנתונים שנאספו לפי תאריך
- אפשרות לצלם מסך מרחוק בזמן אמת
- כיבוי מרחוק של סוכנים
- תצוגת סטטוס פעילות בזמן אמת

## התחברות לממשק הניהול
1. גש לכתובת השרת בדפדפן http://[כתובת_השרת]:9734/login
2. התחבר עם שם משתמש וסיסמה (ברירת המחדל: user1/password1)
3. לאחר התחברות מוצלחת תוכל לצפות ברשימת המכונות המנוטרות ובפעילות שלהן
4. לחיצה על מכונה תפתח את חלון הפעילות המפורט שלה

## תחזוקה ועדכונים
- ניתן לקבל עדכונים מהמאגר באמצעות הרצת סקריפט update.sh:
```bash
chmod +x update.sh
./update.sh
```

## הערות אבטחה
- שנה את פרטי ההתחברות ברירת המחדל בקובץ `users.json`
- עדכן את המפתח הסודי ב-`.env` למפתח מורכב יותר
- ודא כי הגישה לשרת מוגבלת לרשת האירגונית או דרך VPN

## פתרון בעיות נפוצות
- **בעיית חיבור לשרת**: ודא שכתובת השרת מוגדרת נכון ב-`config.yaml` וכי השרת זמין
- **שגיאות הרשאות**: ודא שיש הרשאות כתיבה לתיקיות הלוגים והצילומי מסך
- **התנתקות מהירה**: בדוק את תוקף טוקן ה-JWT ב-`app.py` (כרגע מוגדר לשעה אחת)
- **בעיית פענוח**: ודא כי מפתחות ההצפנה זהים בין השרת לסוכן

## הערות חשובות
- יש להקפיד על קבלת הסכמה מתאימה לפני התקנת הסוכן על מחשבי משתמשים
- לשימוש במערכת לצרכי ניטור ארגוני בלבד, יש לעדכן את המשתמשים על קיום המערכת
- יש לקחת בחשבון את חוקי הפרטיות המקומיים בעת השימוש במערכת
